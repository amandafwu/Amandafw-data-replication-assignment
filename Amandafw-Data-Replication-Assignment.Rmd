---
title: "data-replication-assignment"
author: "Amanda Wu"
date: "2023-11-08"
output: 
  html_document:
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    theme: lumen
---

# Introduction

# Packages
Here is a list of packages I've downloaded for this replication project. 
```{r packages}
library(readr)
library(curl)
library(tidyverse)
library(dplyr)
library(ggpubr)
library(knitr)
# these packages were mentioned within the paper for their statistical analysis 
library(stats)
library(ggplot2)
library(ggeffects)
```

# Data
This is the data provided from the paper. 
```{r uploading data}
# uploading the camera trap data from 2019 - 2020 for predator activity within the landscape analysis
f <- curl("https://raw.githubusercontent.com/amandafwu/Amandafw-data-replication-assignment/main/camera_trap_data_2019_2020.csv") 
camera_trap_data <- read.csv(f, header = TRUE, sep = ",")
head(camera_trap_data)

f <- curl("https://raw.githubusercontent.com/amandafwu/Amandafw-data-replication-assignment/main/camera_trap_data_flowerstrips_1m.csv") 
flowerstrips1m <- read.csv(f, header = TRUE, sep = ",")
head(flowerstrips1m)

f <- curl("https://raw.githubusercontent.com/amandafwu/Amandafw-data-replication-assignment/main/camera_trap_data_flowerstrips_all.csv") 
flowerstripsALL <- read.csv(f, header = TRUE, sep = ",")
head(flowerstripsALL)
```

# Descriptive Statistic

For my descriptive statistic, I will be replicating Table A7 which calculates the mean capture rates of all predators in each vegetation type. It also calculates the SD and 95% CI. 
```{r Descriptive Stat}
# first, I calculated the summary stats with one column to see what I need to include in order to get the values. 
all_predators_wodogs <- group_by(camera_trap_data, Vegetation) %>%
  summarise(
    count = n(),
    mean = mean(allpredators_without_dogs_100, na.rm = TRUE),
    sd = sd(allpredators_without_dogs_100, na.rm = TRUE),
    confint_lower = t.test(allpredators_without_dogs_100, na.rm = TRUE)$conf.int[1],
    confint_upper = t.test(allpredators_without_dogs_100, na.rm = TRUE)$conf.int[2],
    CI_width = ( confint_upper - confint_lower ) / 2
  )
all_predators_wodogs
# then, I turned it into a function so I can enter in all the columns easily
summary_stats <- function(data, group, column) {
  results <- data %>%
      group_by({{group}}) %>%
      summarise(
        count = n(),
        mean = mean({{column}}, na.rm = TRUE),
        sd = sd({{column}}, na.rm = TRUE),
        confint_lower = t.test({{column}}, na.rm = TRUE)$conf.int[1],
        confint_upper = t.test({{column}}, na.rm = TRUE)$conf.int[2],
        CI_width = (confint_upper - confint_lower) / 2
      ) 
}
# this is repetitive, entering the different columns into my function
badger_stats <- summary_stats(camera_trap_data, Vegetation, badger_100)
boar_stats <- summary_stats(camera_trap_data, Vegetation, boar_100)
cats_stats <- summary_stats(camera_trap_data, Vegetation, cats_100)
dog_stats <- summary_stats(camera_trap_data, Vegetation, dog_100)
fox_stats <- summary_stats(camera_trap_data, Vegetation, fox_100)
marten_stats <- summary_stats(camera_trap_data, Vegetation, marten_100)
mouseweasel_stats <- summary_stats(camera_trap_data, Vegetation, mouseweasel_100)
racoon_stats <- summary_stats(camera_trap_data, Vegetation, racoon_100) 
stoat_stats <- summary_stats(camera_trap_data, Vegetation, stoat_100)
# binding all the rows together
table <- bind_rows(
  all_predators_wodogs,
  badger_stats,
  boar_stats,
  cats_stats,
  dog_stats,
  fox_stats,
  marten_stats,
  mouseweasel_stats,
  racoon_stats,
  stoat_stats
  )
table
# ordering all the rows for each vegetation type togeter
ordered1 <- table[order(table$Vegetation), ]
ordered1
ordered1$predatorname <- c("All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat","All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat","All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat","All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat","All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat")
ordered1

ordered2 <- ordered1[, c("Vegetation", "predatorname", setdiff(names(ordered1), c("Vegetation", "predatorname")))]
ordered2
mapping <- c("B" = "Flower Strips",
             "E" = "Field Margins",
             "H" = "Hedge",
             "R" = "Rapeseed",
             "G" = "Winter Cereal")
ordered2$Vegetation <- mapping[ordered2$Vegetation]
ordered2

ordered2[, sapply(ordered2, is.numeric)] <- round(ordered2[, sapply(ordered2, is.numeric)], 3)
ordered2 
```

```{r pt2 }
# to make the final part of the table with all vegetation types for each species, I removed group_by so it would take the mean, SD, and CI from the whole data set, ignoring vegetation
summary_stats2 <- function(data, column) {
  results <- data %>%
      summarise(
        count = n(),
        mean = mean({{column}}, na.rm = TRUE),
        sd = sd({{column}}, na.rm = TRUE),
        confint_lower = t.test({{column}}, na.rm = TRUE)$conf.int[1],
        confint_upper = t.test({{column}}, na.rm = TRUE)$conf.int[2],
        CI_width = (confint_upper - confint_lower) / 2
      ) 
}
#repetitive again
allpred_stat_all <- summary_stats2(camera_trap_data, allpredators_without_dogs_100)
badger_stat_all <- summary_stats2(camera_trap_data, badger_100)
boar_stat_all <- summary_stats2(camera_trap_data, boar_100)
cats_stat_all <- summary_stats2(camera_trap_data, cats_100)
dog_stat_all <- summary_stats2(camera_trap_data, dog_100)
fox_stat_all <- summary_stats2(camera_trap_data, fox_100)
marten_stat_all <- summary_stats2(camera_trap_data, marten_100)
mouseweasel_stat_all <- summary_stats2(camera_trap_data, mouseweasel_100)
racoon_stat_all <- summary_stats2(camera_trap_data, racoon_100)
stoat_stat_all <- summary_stats2(camera_trap_data, stoat_100)
# binding all the rows together
allvegtype_table <- bind_rows(
  allpred_stat_all,
  badger_stat_all,
  boar_stat_all,
  cats_stat_all,
  dog_stat_all,
  fox_stat_all,
  marten_stat_all,
  mouseweasel_stat_all,
  racoon_stat_all,
  stoat_stat_all
  )
allvegtype_table
# adding the predator name column
allvegtype_table$predatorname <- c("All predators", "Badger","Boar","Cats","Dog","Fox","Marten","Mouse weasel","Racoon","Stoat") 
allvegtype_table$Vegetation <- c("All vegetation types", "All vegetation types","All vegetation types","All vegetation types","All vegetation types","All vegetation types","All vegetation types","All vegetation types","All vegetation types","All vegetation types") 
# moving the predator name column to the front
final <- allvegtype_table[, c("Vegetation", "predatorname", setdiff(names(allvegtype_table), c("Vegetation", "predatorname")))]
final

completetable <- rbind(ordered2, final)
completetable
completetable[, sapply(completetable, is.numeric)] <- round(completetable[, sapply(completetable, is.numeric)], 3)

final_table <- completetable[, !names(completetable) %in% c("count","confint_lower","confint_upper")]

kable(final_table)
```

# Figure Replication
This is my replication of Figure 3 from the paper, showing mean capture rates of all predators in different vegetation types. 

![]("/Users/amandawu/Desktop/AN588/Figure3.png")

```{r Figure 3}
p <- ggplot(camera_trap_data, aes(x=reorder(Vegetation, allpredators_without_dogs_100, FUN = mean), y=allpredators_without_dogs_100)) + 
  stat_summary(geom = "point", fun.y = mean, shape = 15, size = 2) +
  ylab("captures/100 days") +
  xlab("vegetation type") +
  stat_summary(fun.data = "mean_sdl", fun.args = list(mult = .3), geom = "errorbar", width = 0.15) +
  scale_x_discrete(labels = c("G" = "winter cereal", "B" = "flower strip", "E" = "field margin", "R" = "rapeseed", "H" = "hedge")) +
  theme(axis.title = element_text(face = "bold"))
p
```

# Inferential Statistic

Performing a Kruskal-Wallis ran sum test of predator capture rates within each vegetation type. 
```{r finding mean}
my_data <- as_tibble(camera_trap_data)
predator <- my_data %>% select(25:33)
predator

colnames(predator)
names <- predator %>% 
  rename(
    Badger = badger_100,
    Boar = boar_100,
    Cat = cats_100,
    Dog = dog_100,
    Fox = fox_100,
    Marten = marten_100,
    MouseWeasel = mouseweasel_100,
    Racoon = racoon_100,
    Stoat = stoat_100
  )
colnames(names)
long <- names %>%
  gather(Predator, Captures)


p <- ggplot(long, aes(reorder(Predator, Captures), Captures)) +
  stat_summary(geom = "point", fun.y = mean) +
  ylab("captures/100 days") +
  xlab("Predator Species") +
  expand_limits(y = c(0,30)) 

p  

sd(predator$badger_100)
mean(predator$badger_100)



head(predator)
class(predator$badger_100)
class(long$Captures)
predator

```

For my descriptive analysis, the paper stated that "our data were not normally distributed (Shapiroâ€“Wilk Test, all p < .001, Table A1)," I calculated the Shapiro-Wilk test for each predator to compare the results to Table A1.  
```{r Table A1 junk}
# this is calculating the Shapiro Wilk test for all predators from 2019-2020 
animals <- as_tibble(camera_trap_data) 
predator <- animals %>% select(25:33,35)
results <- lapply(predator, shapiro.test)
results


shapiro.test(camera_trap_data$allpredators_without_dogs_100)
shapiro.test(camera_trap_data$badger_100)
shapiro.test(camera_trap_data$boar_100)
shapiro.test(camera_trap_data$cats_100)
shapiro.test(camera_trap_data$dog_100)
shapiro.test(camera_trap_data$fox_100)
shapiro.test(camera_trap_data$marten_100)
shapiro.test(camera_trap_data$mouseweasel_100)
shapiro.test(camera_trap_data$racoon_100)
shapiro.test(camera_trap_data$stoat_100)

```




```{r GLMM}
m0 <- lm(data = camera_trap_data, allpredators_100 ~ 1)
summary(m0)
add1(m0, scope = . ~ . + Grass_Area_500m + Forest_Area_500m, test = "F")

my_data <- as_tibble(camera_trap_data)
predator <- my_data %>% select(25:33)
predator
lshap <- lapply(predator, shapiro.test)
lshap[[1]] ## look at the first column results
lres <- sapply(lshap, `[`, c("statistic","p.value"))
as.table(lres)

```

## Sources: 
  + [how to reorder the x-axis](https://stackoverflow.com/questions/3744178/ggplot2-sorting-a-plot)
  + [renaming columns](https://www.datanovia.com/en/lessons/rename-data-frame-columns-in-r/)
  + [plotting average values of certain columns in ggplot](https://stackoverflow.com/questions/58415083/plotting-average-values-from-multiple-columns-in-ggplot2)
  + [backup option](https://www.geeksforgeeks.org/plot-mean-and-standard-deviation-using-ggplot2-in-r/)
